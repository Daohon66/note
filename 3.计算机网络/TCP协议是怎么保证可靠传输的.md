**TCP协议是怎么保证可靠传输的？**

1.应用的数据会被TCP分割为最适合发送的数据块

2.TCP会给发送的每一个包进行编号，接收方对数据包进行排序，把有序数据传送到应用层

3.**校验和：**TCP将保持首部和数据的检验和。这是一个端到端的检验和，目的是为了检测数据在传输的过程发生的变化。如果收到的报文段的检验和有误，TCP就会丢去这个报文段和不确认接收此报文段

4.TCP的接收端会丢弃重复的数据

5.**流量控制：**TCP连接的每一方都有固定大小的缓冲空间，TCP的接收端只允许发送端发送接收端缓冲空间能够接纳的数据。当接收方来不及接收发送方的数据，能提示发送方降低发送的速率，防止包的丢失。TCP使用的流量协议是可变大小的滑动窗口协议。

6.**拥塞控制：**当网络拥塞时，减少数据的发送

7.**ARQ协议：**也是为了实现可靠传输的，ARQ协议的基本原理就是每发完一个分组就停止发送，等待对方确认。在收到确认后再发下一个分组。

8.**超时重传：**当TCP发送出一个报文段后会启动一个定时器，等待目的端确认接收到这个报文段。如果不能及时收到确认，会重发这个报文段

**ARQ协议**

自动重传请求（Automatic Repeat-reQuest，ARQ）是OSI模型中数据链路层和传输层的错误纠正协议之一。它通过使用确认和超时这两个机制，在不可靠服务的基础上实现可靠的信息传输。如果发送方在发送后一段时间之内没有收到确认帧，它通常会重新发送。ARQ包括停止等待ARQ协议和连续ARQ协议。

**滑动窗口和流量控制**

TCP利用滑动窗口实现流量控制。流量控制是为了控制发送方发送速率，保证接收方来得及接收。接收方发送的确认报文中的窗口字段可以用来控制发送方窗口大小，从而影响发送方的发送速率。当把窗口字段设置为0，则发送方不能发送数据。

**拥塞控制**

拥塞控制的前提是当前网络能够承受现有的网络负荷。

在某段时间里，若对网络中某一资源的需求超过了该资源所能提供的可用部分，网络性能就会变坏。这种情况就叫做拥塞，而拥塞控制就是为了防止过多的数据注入到网络中防止网络路由器链路的过载。拥塞控制是一个全局性的过程,涉及到所有的主机、路由器、以及与降低网络传输性能有关的所有因素。

要进行拥塞控制，TCP发送方要维持一个拥塞窗口（CWnd）的状态变量。窗口的大小取决于网络的拥塞程度，并且动态变化。发送方会让自己发送的窗口选择拥塞窗口和接收窗口中较小的一个。

拥塞控制采用了**四**种算法**慢开始、拥塞避免、快重传、快恢复**

**慢开始：**慢开始就是当主机要开始发送数据时，最好是先发送部分数据探测一下，然后再逐渐增大发送窗口。CWnd的初始值为1，没经过一个传播轮次，CWnd翻倍。

**拥塞避免：**拥塞避免就是让拥塞窗口CWnd缓慢增大，每经过一个往返时间就把发送方的CWnd+1.	

**快重传与快恢复：**在TCP/IP中，快速重传和恢复（fast retransmit and recovery, FRR）是一种拥塞控制算法，它能够快速恢复丢失的数据包。如果没有FRR当数据包丢失了就会暂停新的或者复制的数据包发送。在有FRR算法的情况下，接收机接收到一个不按顺序的数据段，会立即给发送机发送一个重复确认。如果发送机接收到三个重复确认，就会假定确认件指出的数据段丢失了，并立即重传这些丢失的数据段。在单独数据包丢失的情况下FRR能够有效工作，而出现多个数据信息包在某一段很短的时间内丢失时，就无法有效工作了。